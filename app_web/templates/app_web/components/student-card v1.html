{% load static %}

<!-- app_web/components/student_card.html -->

<!--
  This component renders a single student card.
  It requires a 'student' object to be available in the context where it is included.

  EXAMPLE USAGE in another template:
  {% for student in pulled_students %}
    {% include 'app_web/components/student_card.html' with student=student %}
  {% endfor %}
-->

<!-- 
  Main Card Container
  - 'relative' is the anchor for all absolutely positioned child elements.
  - 'overflow-hidden' clips the main portrait image to the rounded corners.
  - The border color is dynamically set based on the student's rarity.
-->
<div class="relative w-48 h-64 bg-slate-800 rounded-lg overflow-hidden shadow-lg border-4
    {% if student.student_rarity == 3 %}border-yellow-400/80
    {% elif student.student_rarity == 2 %}border-purple-400/80
    {% else %}border-blue-400/80{% endif %}">

    <!-- 1. Portrait Image (Base Layer) -->
    <!-- This image fills the entire card and acts as the background. -->
    {% if student.asset_id %}
    <img src="{% url 'serve_student_image' student_id=student.student_id image_type='portrait' %}" 
         alt="{{ student.student_name }}" 
         class="w-full h-full object-cover">
    {% endif %}

    <!-- 2. School Logo (Top-Left) -->
    <!-- A semi-transparent, rounded background helps the logo stand out. -->
    <div class="absolute top-2 left-2 w-10 h-10 bg-white rounded-full p-1 shadow-md">
        {% if student.school_id.school_image %}
        <img src="{% url 'serve_school_image' school_id=student.school_id.school_id %}" 
             alt="{{ student.school_id.school_name }}" 
             class="w-full h-full object-contain">
        {% endif %}
    </div>

    <!-- 3. Rarity Stars (Top-Right) -->
    <!-- This flex container arranges the stars horizontally. -->
     <div class="absolute top-2 right-2 w-10 h-10 flex items-center justify-center bg-black/50 backdrop-blur-sm rounded-full shadow-md">
        
        {% if student.student_rarity == 3 %}
            <!-- 
              3-STAR CASE (⁂): Uses absolute positioning for the triangular layout.
              Each star is positioned relative to the circular container.
            -->
            <div class="relative w-full h-full">
                <img src="{% static 'images/web/star_yellow.png' %}" alt="star" class="w-5 h-5 absolute top-0.5 left-1/2 -translate-x-1/2">
                <img src="{% static 'images/web/star_yellow.png' %}" alt="star" class="w-5 h-5 absolute bottom-0.5 left-0.5">
                <img src="{% static 'images/web/star_yellow.png' %}" alt="star" class="w-5 h-5 absolute bottom-0.5 right-0.5">
            </div>

        {% elif student.student_rarity == 2 %}
            <!-- 2-STAR CASE (★★): Uses a simple horizontal flexbox. -->
            <div class="flex gap-0.5">
                {% for i in "x"|rjust:2 %}
                    <img src="{% static 'images/web/star_yellow.png' %}" alt="star" class="w-5 h-5">
                {% endfor %}
            </div>

        {% else %}
            <!-- 1-STAR CASE (★): A single centered star. -->
            <img src="{% static 'images/web/star_yellow.png' %}" alt="star" class="w-5 h-5">
        {% endif %}

    </div>

    <!-- 4. Student Name (Bottom) -->
    <!-- A gradient overlay ensures the text is always readable over the portrait. -->
    <div class="absolute bottom-0 left-0 w-full p-2 pt-8 bg-gradient-to-t from-black/80 to-transparent text-center">
        <h3 class="font-bold text-white text-lg truncate" title="{{ student.student_name }}">
            {{ student.student_name }}
            {% if student.version != 'Original' %}
                <span class="font-normal text-sm text-slate-300">({{ student.version }})</span>
            {% endif %}
        </h3>
    </div>
</div>