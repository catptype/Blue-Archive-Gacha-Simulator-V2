<!-- This is the partial template for the results modal. -->
<div id="gacha-results-html-content">
  <div class="flex flex-col h-full">
      <!-- Modal Header -->
      <div class="flex-shrink-0 p-4 border-b border-slate-600">
          <h2 class="text-2xl font-bold text-cyan-300">Gacha Results</h2>
      </div>

      <!-- 
        This container now holds BOTH the desktop grid and the mobile slider.
        Responsive classes will toggle which one is visible.
      -->
      <div class="flex-grow p-4 overflow-hidden" style="perspective: 1000px;">
          
          <!-- =============================================================== -->
          <!-- 1. DESKTOP VIEW: GRID (Visible on 'xl' screens and up)         -->
          <!-- =============================================================== -->
          <div class="hidden xl:flex w-full h-full items-center justify-center">
            {% with num_students=pulled_students|length %}
            <div class="grid gap-4 grid-cols-1 xl:grid-cols-5">
                {% for student in pulled_students %}
                    <div class="{% if num_students == 1 %}xl:col-start-3{% endif %}">
                        {% include 'app_web/components/student-card.html' with student=student %}
                    </div>
                {% endfor %}
            </div>
            {% endwith %}
          </div>

          <!-- =============================================================== -->
          <!-- 2. MOBILE VIEW: SLIDER (Visible below 'xl' screens)           -->
          <!-- =============================================================== -->
          <!-- This entire section is hidden on desktop screens. -->
          <!-- MOBILE/TABLET VIEW: SLIDER -->
            <div id="mobile-gacha-slider" class="xl:hidden relative w-full h-full">
                <div class="slider-track absolute top-0 left-0 h-full w-full flex items-center transition-transform duration-300 ease-in-out">
                    {% for student in pulled_students %}
                    <div class="slider-slide relative w-full h-full flex-shrink-0 flex items-center justify-center">
                        <div class="w-64">
                            {% include 'app_web/components/student-card.html' with student=student %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                
                {% if pulled_students|length > 1 %}
                <!-- MODIFIED: Navigation buttons are now larger and spaced from the edge -->
                <button class="mobile-nav-arrow mobile-nav-left absolute left-2 top-1/2 -translate-y-1/2 bg-black/40 p-4 rounded-full hover:bg-sky-500/50 transition-colors z-40">
                    <svg class="h-10 w-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
                </button>
                <button class="mobile-nav-arrow mobile-nav-right absolute right-2 top-1/2 -translate-y-1/2 bg-black/40 p-4 rounded-full hover:bg-sky-500/50 transition-colors z-40">
                    <svg class="h-10 w-10 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                </button>

                <div class="mobile-indicator-dots absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-2">
                    {% for student in pulled_students %}
                    <div class="dot w-2 h-2 bg-white/30 rounded-full transition-colors duration-300"></div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
      </div>

    {% if pulled_students|length > 1 %}
    <button id="reveal-all-btn" class="px-4 py-2 bg-slate-600 hover:bg-slate-500 text-white font-semibold rounded-lg transition-colors">
        Reveal All
    </button>
    {% endif %}
  </div>
</div>

<!-- This self-contained script powers the new mobile slider -->
<script id="gacha-results-js-script">
    (function() {

        // --- =============================================================== ---
        // --- MODULE 1: MOBILE SLIDER LOGIC                                 ---
        // --- =============================================================== ---
        // This logic is now wrapped in its own function for clean separation.
        function initializeMobileSlider() {
            const slider = document.getElementById('mobile-gacha-slider');
            // If the slider doesn't exist (e.g., on desktop), exit this specific function.
            if (!slider) return; 

            const track = slider.querySelector('.slider-track');
            const slides = slider.querySelectorAll('.slider-slide');
            const totalSlides = slides.length;
            
            // This guard clause is now SAFE. It only stops the slider setup,
            // not the entire script.
            if (totalSlides <= 1) return;

            const prevBtn = slider.querySelector('.mobile-nav-left');
            const nextBtn = slider.querySelector('.mobile-nav-right');
            const dots = slider.querySelectorAll('.dot');
            let currentIndex = 0;

            function updateSlider() {
                // ... (The updateSlider function is unchanged)
            }

            nextBtn.addEventListener('click', () => { /* ... */ });
            prevBtn.addEventListener('click', () => { /* ... */ });
            
            updateSlider();
        }

        // --- =============================================================== ---
        // --- MODULE 2: CARD FLIPPING LOGIC                                 ---
        // --- =============================================================== ---
        // This logic is now also in its own function and will ALWAYS run.
        function initializeCardFlipping() {
            const allFlippableCards = document.querySelectorAll('.student-card-flipper');
            const revealAllButton = document.getElementById('reveal-all-btn');

            const flipCard = (cardElement) => {
                const innerCard = cardElement.querySelector('.relative.w-full.h-full');
                if (innerCard.classList.contains('is-flipped')) return;
                innerCard.classList.add('is-flipped');
                innerCard.style.transform = 'rotateY(180deg) scale(0.95)';
            };

            allFlippableCards.forEach(card => {
                const handleCardClick = () => flipCard(card);
                card.addEventListener('click', handleCardClick, { once: true });
            });

            if (revealAllButton) {
                revealAllButton.addEventListener('click', () => {
                    allFlippableCards.forEach((card, index) => {
                        setTimeout(() => {
                            flipCard(card);
                        }, index * 75);
                    });
                    // revealAllButton.style.display = 'none';
                }, { once: true });
            }
        }

        // --- =============================================================== ---
        // --- EXECUTION                                                     ---
        // --- =============================================================== ---
        // Now, we call both initialization functions independently.
        initializeMobileSlider();
        initializeCardFlipping();

    })(); // The IIFE now safely contains both modules.
</script>